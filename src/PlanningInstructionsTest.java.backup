import org.apache.poi.hssf.usermodel.HSSFFont;
import org.apache.poi.hssf.util.HSSFColor;
import org.apache.poi.ss.util.CellRangeAddress;
import java.io.*;
import java.security.KeyStore;
import java.sql.*;
import java.util.*;
import java.util.Date;
import javax.mail.*;
import javax.mail.internet.*;
import javax.activation.*;


import org.apache.poi.xssf.usermodel.*;
import org.apache.poi.ss.usermodel.*;
import org.apache.poi.hssf.usermodel.HSSFWorkbook;

/**
 * Created with IntelliJ IDEA.
 * User: zhang.mingming
 * Date: 8/13/13
 * Time: 3:49 PM
 * To change this template use File | Settings | File Templates.
 */
public class PlanningInstructionsTest {
    void generateInstructions(String sic, String beginning_date, String ending_date, String instruction_date, String previous_instruction_date, boolean sending_email_ind)
    {

        //Connection theConn = null;
        Connection prdwhsevwConn = null;
        Connection prdcwfengConn = null;
        System.out.println(sic);

        int rowCounter=0;
        int scheduleCounter = 0;

        try
        {
            // connection to an MS SQL SERVER
            //theConn = getConnection_PRD_CWFENG();
            prdwhsevwConn = getConnection_PRD_WHSEVIEW();
            prdcwfengConn = getConnection_PRD_CWFENG();



            String sql_updated = "create temp table ffo_extracts_otb as\n" +
                            "select cldr_dt as date, orig_sic_cd as orig_sic, 'O' as orig_shift, fnl_dest_sic_cd as dest_sic, ld_to_1_mode_cd as load_to_mode1, ld_to_1_shft_cd as load_to_shift1, case dy_frt_ind when 'Y' then ld_to_1_sic_cd||' D'  else ld_to_1_sic_cd end as load_to_sic1, ld_to_2_shft_cd as load_to_shift2,ld_to_2_sic_cd as load_to_sic2, ld_to_3_shft_cd as load_to_shift3,ld_to_3_sic_cd as load_to_sic3, must_clear_sic_cd as must_clear_sic, must_clear_shft_cd as must_clear_shift, dy_frt_ind as daylane_freight, orig_in_wgt as weight_in, orig_in_vol as cube_in, orig_out_wgt as weight_out, orig_out_vol as cube_out from FLO_FLOW_PLAN_SUMMARY_VW\n" +
                            "where orig_shft_cd = 'OTB' and date >= '"+ beginning_date + "' and date <= '" + ending_date + "' \n" +
                            "and orig_sic='" + sic + "' distribute on (orig_sic, dest_sic); \n"+
                    "update ffo_extracts_otb set load_to_sic2='' where load_to_sic2 is null;\n" +
                    "update ffo_extracts_otb set load_to_sic3='' where load_to_sic3 is null;\n" +
                    "update ffo_extracts_otb set load_to_shift2='' where load_to_shift2 is null;\n" +
                    "update ffo_extracts_otb set load_to_shift3='' where load_to_shift3 is null;\n" +
                    "update ffo_extracts_otb set must_clear_sic ='' where must_clear_sic is null;\n" +
                    "update ffo_extracts_otb set must_clear_shift ='' where must_clear_shift is null;\n" +
                    "update ffo_extracts_otb set must_clear_sic = '' where daylane_freight = 'Y';\n" +
                    "update ffo_extracts_otb set must_clear_shift = '' where daylane_freight = 'Y';\n" +
                    "create  temp table ffo_base_plan_od as\n" +
                    "(select orig_sic, orig_shift, load_to_mode1, load_to_sic1, load_to_shift1, must_clear_sic, must_clear_shift, daylane_freight, load_to_sic2, load_to_shift2, load_to_sic3, load_to_shift3, dest_sic, sum(case when cube_out/1157.0 >=0.4 or weight_out >=22500 then 1 else 0 end) as head_load_hit_days, head_load_hit_days/5.0 as head_load_hit_ratio, case when head_load_hit_days =0 then 0 else sum(case when cube_out/1157.0 >=0.4 or weight_out >=22500 then weight_out else 0 end)/head_load_hit_days end as head_load_avg_weight, case when head_load_hit_days=0 then 0 else sum(case when cube_out/1157.0 >=0.4 or weight_out >=22500 then cube_out/1157.0 else 0 end)/head_load_hit_days end as head_load_avg_cube, sum(case when cube_out/1157.0 >=0.85 or weight_out >=22500 then 1 else 0 end) as bypass_hit_days,  bypass_hit_days/5.0 as bypass_hit_ratio, case when bypass_hit_days = 0 then 0 else sum(case when cube_out/1157.0 >=0.85 or weight_out >=22500 then weight_out else 0 end)/bypass_hit_days end as bypass_avg_weight, case when bypass_hit_days = 0 then 0 else sum(case when cube_out/1157.0 >=0.85 or weight_out >=22500 then cube_out/1157.0 else 0 end)/bypass_hit_days end as bypass_avg_cube, case when head_load_hit_ratio >= 0.6 then 'X' else '' end as head_load, case when bypass_hit_ratio >= 0.8 then 'X' else '' end as bypass, sum(cube_out/1157.0)/5.0 as avg_cube, sum(weight_out)/5.0 as avg_weight  from ffo_extracts_otb \n" +
                    "group by 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13);\n" +
                    "create temp table exclusive_lanes as\n" +
                    "select LD_AT_NODE_NM, LD_AT_SHFT_CD, LD_TO_NODE_NM, LD_TO_SHFT_CD, LD_LEG_TYP from prd_whseview..FLO_LOAD_LEG_VW where ld_leg_typ = 0 and move_mode_typ = 'S';\n" +
                    "create temp table ffo_base_plan_od_exclusive as \n" +
                    "select A.orig_sic, A.orig_shift, A.load_to_mode1, A.load_to_sic1, A.load_to_shift1, A.must_clear_sic, A.must_clear_shift, A.daylane_freight, A.load_to_mode2, A.load_to_sic2, A.load_to_shift2,case when B.ld_leg_typ is null then '' else 'HSS' end as load_to_mode3,  A.load_to_sic3, A.load_to_shift3, A.dest_sic,A.head_load,A.bypass,A.head_load_hit_ratio, A.head_load_avg_weight,A.head_load_avg_cube,A.bypass_hit_ratio, A.bypass_avg_weight,A.bypass_avg_cube, A.avg_weight, A.avg_cube from (select A.orig_sic, A.orig_shift, A.load_to_mode1, A.load_to_sic1, A.load_to_shift1, A.must_clear_sic, A.must_clear_shift, A.daylane_freight, case when B.ld_leg_typ is null then '' else 'HSS' end as load_to_mode2, A.load_to_sic2, A.load_to_shift2, A.load_to_sic3, A.load_to_shift3, A.dest_sic,A.head_load_hit_ratio, A.head_load_avg_weight,A.head_load_avg_cube,A.bypass_hit_ratio, A.bypass_avg_weight,A.bypass_avg_cube, A.head_load,A.bypass, A.avg_weight, A.avg_cube from ffo_base_plan_od as A left outer join exclusive_lanes as B\n" +
                    "on A.load_to_sic1 = B.ld_at_node_nm and\n" +
                    "      A.load_to_shift1 = B.ld_at_shft_cd and\n" +
                    "      A.load_to_sic2 = B.ld_to_node_nm and\n" +
                    "      A.load_to_shift2 = B.ld_to_shft_cd) as A\n" +
                    "left outer join exclusive_lanes as B\n" +
                    "on\n" +
                    "      A.load_to_sic2 = B.ld_at_node_nm and\n" +
                    "      A.load_to_shift2 = B.ld_at_shft_cd and\n" +
                    "      A.load_to_sic3 = B.ld_to_node_nm and\n" +
                    "      A.load_to_shift3 = B.ld_to_shft_cd;\n" +
                    "\n" +
                    "create temp table ffo_base_plan_3rd_fac_combined as \n" +
                    "select orig_sic,\n" +
                    "       orig_shift,\n" +
                    "       load_to_mode1,\n" +
                    "       load_to_sic1,\n" +
                    "       load_to_shift1,\n" +
                    "       must_clear_sic,\n" +
                    "       must_clear_shift,\n" +
                    "       daylane_freight,\n" +
                    "       '' as load_to_mode2,\n" +
                    "       load_to_sic2,\n" +
                    "       load_to_shift2,\n" +
                    "       '' as load_to_mode3,\n" +
                    "       load_to_sic3,\n" +
                    "       load_to_shift3,\n" +
                    "       '' as dest_sic,\n" +
                    "       case when sum(mark_head_load)/5.0 >= 0.6 then 'X' else '' end as head_load,\n" +
                    "       case when sum(mark_bypass)/5.0 >= 0.8 then 'X' else '' end as bypass,\n" +
                    "       sum(mark_head_load)/5.0 as head_load_hit_ratio,\n" +
                    "       case when sum(mark_head_load) =0 then 0 else sum(case when total_cube_out >=0.4 then total_weight_out else 0 end)/sum(mark_head_load) end as head_load_avg_weight, \n" +
                    "       case when sum(mark_head_load)= 0 then 0 else sum(case when total_cube_out >=0.4 then total_cube_out else 0 end)/sum(mark_head_load) end as head_load_avg_cube, \n" +
                    "       sum(mark_bypass)/5.0 as bypass_hit_ratio, \n" +
                    "       case when sum(mark_bypass) =0 then 0 else sum(case when total_cube_out >=0.4 then total_weight_out else 0 end)/sum(mark_bypass) end as bypass_avg_weight, \n" +
                    "       case when sum(mark_bypass)= 0 then 0 else sum(case when total_cube_out >=0.4 then total_cube_out else 0 end)/sum(mark_bypass) end as bypass_avg_cube,\n" +
                    "       sum(total_weight_out)/5.0 as avg_weight,\n" +
                    "       sum(total_cube_out)/5.0 as avg_cube\n" +
                    " from\n" +
                    "      (select date,\n" +
                    "              orig_sic,\n" +
                    "              orig_shift,\n" +
                    "              load_to_mode1,\n" +
                    "              load_to_sic1,\n" +
                    "              load_to_shift1,\n" +
                    "              must_clear_sic, \n" +
                    "              must_clear_shift,\n" +
                    "              daylane_freight,\n" +
                    "              load_to_sic2,\n" +
                    "              load_to_shift2,\n" +
                    "              load_to_sic3,\n" +
                    "              load_to_shift3,\n" +
                    "              sum(weight_out) as total_weight_out,\n" +
                    "              sum(cube_out)/1157.0 as total_cube_out,\n" +
                    "              case when total_cube_out>=0.4 or total_weight_out >=22500 then 1 else 0 end as mark_head_load,\n" +
                    "              case when total_cube_out>=0.85 or total_weight_out >=22500 then 1 else 0 end as mark_bypass   \n" +
                    "       from ffo_extracts_otb\n" +
                    "       where load_to_sic3 != '' and load_to_shift3 != '' \n" +
                    "       group by 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13\n" +
                    "      ) as A\n" +
                    "group by 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12,13, 14;\n" +
                    "\n" +
                    "\n" +
                    "create temp table ffo_base_plan_2nd_fac_combined as \n" +
                    "select orig_sic,\n" +
                    "       orig_shift,\n" +
                    "       load_to_mode1,\n" +
                    "       load_to_sic1,\n" +
                    "       load_to_shift1,\n" +
                    "       must_clear_sic,\n" +
                    "       must_clear_shift,\n" +
                    "       daylane_freight,\n" +
                    "       '' as load_to_mode2,\n" +
                    "       load_to_sic2,\n" +
                    "       load_to_shift2,\n" +
                    "       '' as load_to_mode3,\n" +
                    "       '' as load_to_sic3,\n" +
                    "       '' as load_to_shift3,\n" +
                    "       '' as dest_sic,\n" +
                    "       case when sum(mark_head_load)/5.0 >= 0.6 then 'X' else '' end as head_load,\n" +
                    "       case when sum(mark_bypass)/5.0 >= 0.8 then 'X' else '' end as bypass,\n" +
                    "       sum(mark_head_load)/5.0 as head_load_hit_ratio,\n" +
                    "       case when sum(mark_head_load) =0 then 0 else sum(case when total_cube_out >=0.4 then total_weight_out else 0 end)/sum(mark_head_load) end as head_load_avg_weight, \n" +
                    "       case when sum(mark_head_load)= 0 then 0 else sum(case when total_cube_out >=0.4 then total_cube_out else 0 end)/sum(mark_head_load) end as head_load_avg_cube, \n" +
                    "       sum(mark_bypass)/5.0 as bypass_hit_ratio, \n" +
                    "       case when sum(mark_bypass) =0 then 0 else sum(case when total_cube_out >=0.4 then total_weight_out else 0 end)/sum(mark_bypass) end as bypass_avg_weight, \n" +
                    "       case when sum(mark_bypass)= 0 then 0 else sum(case when total_cube_out >=0.4 then total_cube_out else 0 end)/sum(mark_bypass) end as bypass_avg_cube, \n" +
                    "       sum(total_weight_out)/5.0 as avg_weight, \n" +
                    "       sum(total_cube_out)/5.0 as avg_cube \n" +
                    " from\n" +
                    "      (select date,\n" +
                    "              orig_sic,\n" +
                    "              orig_shift,\n" +
                    "              load_to_mode1,\n" +
                    "              load_to_sic1,\n" +
                    "              load_to_shift1,\n" +
                    "              must_clear_sic, \n" +
                    "              must_clear_shift,\n" +
                    "              daylane_freight,\n" +
                    "              load_to_sic2,\n" +
                    "              load_to_shift2,\n" +
                    "              sum(weight_out) as total_weight_out,\n" +
                    "              sum(cube_out)/1157.0 as total_cube_out,\n" +
                    "              case when total_cube_out>=0.4 or total_weight_out >=22500 then 1 else 0 end as mark_head_load,\n" +
                    "              case when total_cube_out>=0.85 or total_weight_out >=22500 then 1 else 0 end as mark_bypass   \n" +
                    "       from ffo_extracts_otb\n" +
                    "       where load_to_sic2 != '' and load_to_shift2 != '' \n" +
                    "       group by 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11\n" +
                    "      ) as A\n" +
                    "group by 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12;\n" +
                    "\n" +
                    "create temp table ffo_base_plan_must_clear_sic_combined as \n" +
                    "select orig_sic,\n" +
                    "       orig_shift,\n" +
                    "       load_to_mode1,\n" +
                    "       load_to_sic1,\n" +
                    "       load_to_shift1,\n" +
                    "       must_clear_sic,\n" +
                    "       must_clear_shift,\n" +
                    "       daylane_freight,\n" +
                    "       '' as load_to_mode2,\n" +
                    "       '' as load_to_sic2,\n" +
                    "       '' as load_to_shift2,\n" +
                    "       '' as load_to_mode3,\n" +
                    "       '' as load_to_sic3,\n" +
                    "       '' as load_to_shift3,\n" +
                    "       '' as dest_sic,\n" +
                    "       case when sum(mark_head_load)/5.0 >= 0.6 then 'X' else '' end as head_load,\n" +
                    "       case when sum(mark_bypass)/5.0 >= 0.8 then 'X' else '' end as bypass,\n" +
                    "       sum(mark_head_load)/5.0 as head_load_hit_ratio,\n" +
                    "       case when sum(mark_head_load) =0 then 0 else sum(case when total_cube_out >=0.4 then total_weight_out else 0 end)/sum(mark_head_load) end as head_load_avg_weight, \n" +
                    "       case when sum(mark_head_load)= 0 then 0 else sum(case when total_cube_out >=0.4 then total_cube_out else 0 end)/sum(mark_head_load) end as head_load_avg_cube, \n" +
                    "       sum(mark_bypass)/5.0 as bypass_hit_ratio, \n" +
                    "       case when sum(mark_bypass) =0 then 0 else sum(case when total_cube_out >=0.4 then total_weight_out else 0 end)/sum(mark_bypass) end as bypass_avg_weight, \n" +
                    "       case when sum(mark_bypass)= 0 then 0 else sum(case when total_cube_out >=0.4 then total_cube_out else 0 end)/sum(mark_bypass) end as bypass_avg_cube, \n" +
                    "       sum(total_weight_out)/5.0 as avg_weight,\n" +
                    "       sum(total_cube_out)/5.0 as avg_cube \n" +
                    "  from\n" +
                    "      (select date,\n" +
                    "              orig_sic,\n" +
                    "              orig_shift,\n" +
                    "              load_to_mode1,\n" +
                    "              load_to_sic1,\n" +
                    "              load_to_shift1,\n" +
                    "              must_clear_sic, \n" +
                    "              must_clear_shift,\n" +
                    "              daylane_freight,\n" +
                    "              sum(weight_out) as total_weight_out,\n" +
                    "              sum(cube_out)/1157.0 as total_cube_out,\n" +
                    "              case when total_cube_out>=0.4 or total_weight_out >=22500 then 1 else 0 end as mark_head_load,\n" +
                    "              case when total_cube_out>=0.85 or total_weight_out >=22500 then 1 else 0 end as mark_bypass   \n" +
                    "       from ffo_extracts_otb\n" +
                    "       where must_clear_sic != '' and must_clear_shift != '' \n" +
                    "       group by 1, 2, 3, 4, 5, 6, 7, 8, 9\n" +
                    "      ) as A\n" +
                    "group by 1, 2, 3, 4, 5, 6, 7, 8, 9, 10;\n" +
                    "\n" +
                    "create temp table ffo_base_plan_1st_fac_combined as \n" +
                    "select orig_sic,\n" +
                    "       orig_shift,\n" +
                    "       load_to_mode1,\n" +
                    "       load_to_sic1,\n" +
                    "       load_to_shift1,\n" +
                    "       '' as must_clear_sic,\n" +
                    "       '' as must_clear_shift,\n" +
                    "       '' as daylane_freight,\n" +
                    "       '' as load_to_mode2,\n" +
                    "       '' as load_to_sic2,\n" +
                    "       '' as load_to_shift2,\n" +
                    "       '' as load_to_mode3,\n" +
                    "       '' as load_to_sic3,\n" +
                    "       '' as load_to_shift3,\n" +
                    "       '' as dest_sic,\n" +
                    "       case when sum(mark_head_load)/5.0 >= 0.6 then 'X' else '' end as head_load,\n" +
                    "       case when sum(mark_bypass)/5.0 >= 0.8 then 'X' else '' end as bypass,\n" +
                    "       sum(mark_head_load)/5.0 as head_load_hit_ratio,\n" +
                    "       case when sum(mark_head_load) =0 then 0 else sum(case when total_cube_out >=0.4 then total_weight_out else 0 end)/sum(mark_head_load) end as head_load_avg_weight, \n" +
                    "       case when sum(mark_head_load)= 0 then 0 else sum(case when total_cube_out >=0.4 then total_cube_out else 0 end)/sum(mark_head_load) end as head_load_avg_cube, \n" +
                    "       sum(mark_bypass)/5.0 as bypass_hit_ratio, \n" +
                    "       case when sum(mark_bypass) =0 then 0 else sum(case when total_cube_out >=0.4 then total_weight_out else 0 end)/sum(mark_bypass) end as bypass_avg_weight, \n" +
                    "       case when sum(mark_bypass)= 0 then 0 else sum(case when total_cube_out >=0.4 then total_cube_out else 0 end)/sum(mark_bypass) end as bypass_avg_cube, \n" +
                    "       sum(total_weight_out)/5.0 as avg_weight,\n" +
                    "       sum(total_cube_out)/5.0 as avg_cube \n" +
                    "  from\n" +
                    "      (select date,\n" +
                    "              orig_sic,\n" +
                    "              orig_shift,\n" +
                    "              load_to_mode1,\n" +
                    "              load_to_sic1,\n" +
                    "              load_to_shift1,\n" +
                    "              sum(weight_out) as total_weight_out,\n" +
                    "              sum(cube_out)/1157.0 as total_cube_out,\n" +
                    "              case when total_cube_out>=0.4 or total_weight_out >=22500 then 1 else 0 end as mark_head_load,\n" +
                    "              case when total_cube_out>=0.85 or total_weight_out >=22500 then 1 else 0 end as mark_bypass   \n" +
                    "       from ffo_extracts_otb\n" +
                    "       where load_to_sic1 != '' and load_to_shift1 != '' \n" +
                    "       group by 1, 2, 3, 4, 5, 6\n" +
                    "      ) as A\n" +
                    "group by 1, 2, 3, 4, 5, 6, 7;\n"+
                    "create temp table ffo_planning_tool as \n" +
                    "((select * from ffo_base_plan_od_exclusive \n" +
                    "union\n" +
                    "--group by load_to_sic3 and load_to_shift3\n" +
                    "select * from ffo_base_plan_3rd_fac_combined\n" +
                    "union\n" +
                    "--group by load_to_sic2 and load_to_shift2\n" +
                    "select * from ffo_base_plan_2nd_fac_combined\n" +
                    "union\n" +
                    "--group by must_clear_sic and must_clear_shift\n" +
                    "select * from ffo_base_plan_must_clear_sic_combined\n" +
                    "union\n" +
                    "select * from ffo_base_plan_1st_fac_combined)\n" +
                    "--group by load_to_sic1 and load_to_shift1\n" +
                    "\n" +
                    "order by orig_sic, orig_shift, load_to_mode1, load_to_sic1 desc, load_to_shift1 desc, must_clear_sic desc, must_clear_shift desc, load_to_sic2 desc, load_to_shift2 desc, load_to_sic3 desc, load_to_shift3 desc, dest_sic desc\n" +
                    ");\n" +
                    " create temp table sic_doors as \n" +
                    "(select  dest_sic as sic from ffo_base_plan_od_exclusive where head_load ='X'\n" +
                    "union\n" +
                    "select load_to_sic3 as sic from ffo_base_plan_3rd_fac_combined where head_load ='X'\n" +
                    "union\n" +
                    "select load_to_sic2 as sic from ffo_base_plan_2nd_fac_combined where head_load ='X'\n" +
                    "union\n" +
                    "select  must_clear_sic as sic  from ffo_base_plan_must_clear_sic_combined where head_load ='X'\n" +
                    "union\n" +
                    "select load_to_sic1 as sic from ffo_base_plan_1st_fac_combined where head_load ='X'); ";





            String sql_query1 = "select *  from ffo_planning_tool order by orig_sic, orig_shift, load_to_mode1, load_to_sic1 desc, load_to_shift1 desc, must_clear_sic desc, must_clear_shift desc, daylane_freight desc, load_to_sic2 desc, load_to_shift2 desc, load_to_sic3 desc, load_to_shift3 desc, dest_sic desc;";







            String add_door_sql_query = "select distinct A.door_sic from \n" +
                    "sic_doors as A\n" +
                    "left join\n" +
                    "sic_doors as B\n" +
                    " on\n" +
                    "A.door_sic = B.door_sic and\n" +
                    "A.orig_sic = B.orig_sic and \n" +
                    "B.launch_date = A.launch_date -7\n" +
                    "where A.launch_date = '" + instruction_date + "' and A.orig_sic='" + sic + "' and B.door_sic is null " +
                    "order by A.door_sic; ";

            System.out.println(sql_updated);
            System.out.println(sql_query1);
            System.out.println(add_door_sql_query);

            String remove_door_sql_query = "select A.door_sic from (select distinct door_sic from \n" +
                    "sic_doors where launch_date= '" + previous_instruction_date + "' and orig_sic='" + sic + "') as A\n" +
                    "left join\n" +
                    "(select distinct door_sic from \n" +
                    "sic_doors where launch_date='" + instruction_date + "' and orig_sic = '" + sic + "') as B on A.door_sic = B.door_sic where B.door_sic is null;";

            System.out.println(remove_door_sql_query);

            Statement stmt = prdwhsevwConn.createStatement();
            stmt.executeUpdate(sql_updated);
            System.out.println("point 1");
            ResultSet rs = stmt.executeQuery(sql_query1);
            System.out.println("point 2");
            rs.setFetchSize(10000);



            Statement stmt_cwfeng = prdcwfengConn.createStatement();

            System.out.println("point 2.2");



            String orig_sic;
            String orig_shift;
            String load_to_mode1;
            String load_to_sic1;
            String must_clear_sic;
            String must_clear_shift;
            String daylane_freight;
            String load_to_mode2;
            String load_to_sic2;
            String load_to_mode3;
            String load_to_sic3;
            String dest_sic;
            String head_load;
            String bypass;
            double head_load_hit_ratio;
            double head_load_avg_weight;
            double head_load_avg_cube;
            double bypass_hit_ratio;
            double bypass_avg_weight;
            double bypass_avg_cube;
            double avg_weight;
            double avg_cube;


            Workbook workbook = new HSSFWorkbook();

            Sheet sheet = workbook.createSheet("Door Planning");
            Sheet sheet1 = workbook.createSheet("Door Changes");
            System.out.println("point 3");

            //the header
            Font header_font = workbook.createFont();
            header_font.setFontName("ARIAL");
            header_font.setFontHeightInPoints((short)13);
            header_font.setBoldweight(Font.BOLDWEIGHT_BOLD);

            CellStyle header_style = workbook.createCellStyle();
            header_style.setFont(header_font);
            header_style.setAlignment(CellStyle.ALIGN_CENTER);
            header_style.setWrapText(true);

            CellStyle header_highlighted_style = workbook.createCellStyle();
            header_highlighted_style.setFillForegroundColor(IndexedColors.GREEN.getIndex());
            header_highlighted_style.setFillPattern(CellStyle.SOLID_FOREGROUND);
            header_highlighted_style.setFont(header_font);
            header_highlighted_style.setAlignment(CellStyle.ALIGN_CENTER);
            //header_highlighted_style.setWrapText(true);




            //header_format.setBorder(jxl.format.Border.ALL, jxl.format.BorderLineStyle.THIN, jxl.format.Colour.BLACK);

           // String headers[] = new String[] {"Sic", "Shift", "Load To Mode1", "1st FAC", "Must Move", "Must Move to Shift", "Load To Mode2", "2nd FAC",  "Load To Mode3", "3rd FAC",
           //         "Dest Sic", "Head Load", "Bypass", "Head Load Hit Ratio", "Head Load Avg Weight", "Head Load Avg Cube", "Bypass Hit Ratio", "Bypass Avg Weight", "Bypass Avg Cube"};

           // String headers[] = new String[] {"SIC", "Shift", "Load To Mode1", "DAYFRT", "1st FAC", "Must Clear", "Must Clear Shift", "2nd FAC", "3rd FAC",
           //                  "Dest Sic", "Head Load", "Bypass", "Head Load Hit Ratio", "Head Load Avg Weight", "Head Load Avg Cube", "Bypass Hit Ratio", "Bypass Avg Weight", "Bypass Avg Cube"};


            String headers[] = new String[] {"SIC", "Shift", "Load To Mode1", "DAYFRT", "1st FAC", "Must Clear", "Must Clear Shift", "2nd FAC", "3rd FAC",
                    "Dest Sic", "Head Load", "Bypass", "AVG WGT", "AVG CUBE"};

            //create header row
            Row row = sheet.createRow(rowCounter);

            // Create a cell and put a value in it.


            for( int i = 0; i < headers.length; i++)
            {
                Cell cell = row.createCell(i);
                cell.setCellValue(headers[i]);
                if ( i == 3 || i == 4 || i == 5 ||i == 7 ||i == 8 )
                {
                   cell.setCellStyle(header_highlighted_style);
                }
                else
                {
                    cell.setCellStyle(header_style);
                }


            }

            //general label content format
            Font text_font = workbook.createFont();
            text_font.setFontName("ARIAL");
            text_font.setFontHeightInPoints((short)10);

            Font bold_font = workbook.createFont();
            bold_font.setFontName("ARIAL");
            bold_font.setBoldweight(Font.BOLDWEIGHT_BOLD);
            bold_font.setFontHeightInPoints((short)10);

            CellStyle text_style = workbook.createCellStyle();
            text_style.setFont(text_font);
            text_style.setAlignment(CellStyle.ALIGN_CENTER);

            CellStyle pct_style = workbook.createCellStyle();
            pct_style.setDataFormat(workbook.createDataFormat().getFormat("0%"));
            pct_style.setAlignment(CellStyle.ALIGN_CENTER);
            header_highlighted_style.setFont(text_font);

            CellStyle callout_style = workbook.createCellStyle();
            callout_style.setFillForegroundColor(IndexedColors.ORANGE.getIndex());
            callout_style.setFillPattern(CellStyle.SOLID_FOREGROUND);
            callout_style.setFont(bold_font);
            callout_style.setAlignment(CellStyle.ALIGN_CENTER);

            CellStyle number_style = workbook.createCellStyle();
            number_style.setDataFormat(workbook.createDataFormat().getFormat("#,##0"));
            number_style.setAlignment(CellStyle.ALIGN_CENTER);
            number_style.setFont(text_font);


            //highlighted format for Recommended door
            CellStyle x_style = workbook.createCellStyle();
            x_style.setFillForegroundColor(IndexedColors.GREY_25_PERCENT.getIndex());
            x_style.setFillPattern(CellStyle.SOLID_FOREGROUND);
            x_style.setFont(bold_font);
            x_style.setAlignment(CellStyle.ALIGN_CENTER);

            //highlighted format for 1st FAC
            CellStyle first_FAC_style = workbook.createCellStyle();
            first_FAC_style.setFillForegroundColor(IndexedColors.GREEN.getIndex());
            first_FAC_style.setFillPattern(CellStyle.SOLID_FOREGROUND);
            first_FAC_style.setFont(bold_font);
            first_FAC_style.setAlignment(CellStyle.ALIGN_CENTER);

            //highlighted format for must clear FAC
            CellStyle must_clear_style = workbook.createCellStyle();
            must_clear_style.setFillForegroundColor(IndexedColors.LIGHT_GREEN.getIndex());
            must_clear_style.setFillPattern(CellStyle.SOLID_FOREGROUND);
            must_clear_style.setFont(bold_font);
            must_clear_style.setAlignment(CellStyle.ALIGN_CENTER);

            //highlighted format for 2nd FAC
            CellStyle second_FAC_style = workbook.createCellStyle();
            second_FAC_style.setFillForegroundColor(IndexedColors.LIGHT_GREEN.getIndex());
            second_FAC_style.setFillPattern(CellStyle.SOLID_FOREGROUND);
            second_FAC_style.setFont(bold_font);
            second_FAC_style.setAlignment(CellStyle.ALIGN_CENTER);

            //highlighted format for 3rd FAC
            CellStyle third_FAC_style = workbook.createCellStyle();
            third_FAC_style.setFillForegroundColor(IndexedColors.LIGHT_GREEN.getIndex());
            third_FAC_style.setFillPattern(CellStyle.SOLID_FOREGROUND);
            third_FAC_style.setFont(bold_font);
            third_FAC_style.setAlignment(CellStyle.ALIGN_CENTER);

            //highlighted format for dest
            CellStyle dest_style = workbook.createCellStyle();
            dest_style.setFillForegroundColor(IndexedColors.LIGHT_YELLOW.getIndex());
            dest_style.setFillPattern(CellStyle.SOLID_FOREGROUND);
            dest_style.setAlignment(CellStyle.ALIGN_CENTER);

            CellStyle empty_row_style = workbook.createCellStyle();
            empty_row_style.setFillForegroundColor(IndexedColors.GREY_25_PERCENT.getIndex());
            empty_row_style.setFillPattern(CellStyle.SOLID_FOREGROUND);

            System.out.println("point 3");

            while (rs.next()) {
                rowCounter++;
                Row new_row = sheet.createRow(rowCounter);
                boolean recommended_door = false;
                orig_sic = rs.getString("orig_sic");
                orig_shift = rs.getString("orig_shift");
                load_to_mode1 = rs.getString("load_to_mode1");
                if ( !load_to_mode1.equals('S'))
                {
                    load_to_mode1 = "";
                }
                load_to_sic1 = rs.getString("load_to_sic1");
                must_clear_sic = rs.getString("must_clear_sic");
                must_clear_shift = rs.getString("must_clear_shift");
                daylane_freight = rs.getString("daylane_freight");
                if (daylane_freight.equals("Y"))
                {
                    daylane_freight = "D";
                }
                else
                {
                    daylane_freight = "";
                }

                load_to_sic2 = rs.getString("load_to_sic2");
                load_to_sic3 = rs.getString("load_to_sic3");
                dest_sic = rs.getString("dest_sic");
                head_load = rs.getString("head_load");
                bypass = rs.getString("bypass");
                avg_weight = rs.getDouble("avg_weight");
                avg_cube = rs.getDouble("avg_cube");

                if (head_load.equals("X"))
                {
                    Cell cell = new_row.createCell(10);
                    cell.setCellValue(head_load);
                    cell.setCellStyle(x_style);
                    recommended_door = true;
                }


                if (bypass.equals("X"))
                {
                    Cell cell = new_row.createCell(11);
                    cell.setCellValue(head_load);
                    cell.setCellStyle(x_style);
                    recommended_door = true;
                }


              //  head_load_hit_ratio = rs.getDouble("head_load_hit_ratio");
              //  jxl.write.Number head_load_hit_ratio_number = new jxl.write.Number( 12, rowCounter, head_load_hit_ratio, pctFormat);
              //  sheet.addCell(head_load_hit_ratio_number);

             //   head_load_avg_weight = rs.getDouble("head_load_avg_weight");
             //   jxl.write.Number head_load_avg_weight_number = new jxl.write.Number( 13, rowCounter, head_load_avg_weight, intFormat);
             //   sheet.addCell(head_load_avg_weight_number);

             //   head_load_avg_cube = rs.getDouble("head_load_avg_cube");
             //   jxl.write.Number head_load_avg_cube_number = new jxl.write.Number( 12, rowCounter, head_load_avg_cube, pctFormat);
             //   sheet.addCell(head_load_avg_cube_number);

             //   bypass_hit_ratio = rs.getDouble("bypass_hit_ratio");
             //   jxl.write.Number bypass_hit_ratio_number = new jxl.write.Number( 15, rowCounter, bypass_hit_ratio, pctFormat);
             //   sheet.addCell(bypass_hit_ratio_number);

             //   bypass_avg_weight = rs.getDouble("bypass_avg_weight");
             //   jxl.write.Number bypass_avg_weight_number = new jxl.write.Number( 16, rowCounter, bypass_avg_weight, intFormat);
             //   sheet.addCell(bypass_avg_weight_number);

             //   bypass_avg_cube = rs.getDouble("bypass_avg_cube");
             //   jxl.write.Number bypass_avg_cube_number = new jxl.write.Number( 13, rowCounter, bypass_avg_cube, pctFormat);
              //  sheet.addCell(bypass_avg_cube_number);


                if (dest_sic.equals(""))
                {
                    if (load_to_sic3.equals("") )
                    {
                        if ( load_to_sic2.equals(""))
                        {
                            if ( must_clear_sic.equals(""))
                            {
                                if (!load_to_sic1.equals(""))
                                {
                                    load_to_sic1 = load_to_sic1 + " Total";
                                    Cell cell = new_row.createCell(4);
                                    cell.setCellValue(load_to_sic1);
                                    cell.setCellStyle(recommended_door?callout_style:first_FAC_style);

                                    Cell avg_weight_cell = new_row.createCell(12);
                                    avg_weight_cell.setCellValue(avg_weight);
                                    avg_weight_cell.setCellStyle(number_style);

                                    Cell avg_cube_cell = new_row.createCell(13);
                                    avg_cube_cell.setCellValue(avg_cube);
                                    avg_cube_cell.setCellStyle(pct_style);

                                    //insert a gray row
                                    rowCounter++;
                                    Row empty_row = sheet.createRow(rowCounter);

                                    empty_row.setRowStyle(empty_row_style);
                                    continue;
                                }
                            }
                            else
                            {
                                //print move to sic 1 and total
                                must_clear_sic = must_clear_sic + " Total";
                                Cell cell = new_row.createCell(5);
                                cell.setCellValue(must_clear_sic);
                                cell.setCellStyle(recommended_door?callout_style:must_clear_style);


                                continue;
                            }
                        }
                        else
                        {
                            //print load to sic 2 and total
                            load_to_sic2 = load_to_sic2 + " Total";
                            Cell cell = new_row.createCell(7);
                            cell.setCellValue(load_to_sic2);
                            cell.setCellStyle(recommended_door?callout_style:second_FAC_style);

                            continue;
                        }
                    }
                    else
                    {
                        //print load to sic 3 and total
                        load_to_sic3 = load_to_sic3 + " Total";
                        Cell cell = new_row.createCell(8);
                        cell.setCellValue(load_to_sic3);
                        cell.setCellStyle(recommended_door?callout_style:third_FAC_style);

                        continue;
                    }

                }

                Cell orig_sic_cell = new_row.createCell(0);
                orig_sic_cell.setCellValue(orig_sic);
                orig_sic_cell.setCellStyle(text_style);

                Cell orig_shift_cell = new_row.createCell(1);
                orig_shift_cell.setCellValue(orig_shift);
                orig_shift_cell.setCellStyle(text_style);

                Cell load_to_mode1_cell = new_row.createCell(2);
                load_to_mode1_cell.setCellValue(load_to_mode1);
                load_to_mode1_cell.setCellStyle(text_style);

                Cell daylane_freight_cell = new_row.createCell(3);
                daylane_freight_cell.setCellValue(daylane_freight);
                daylane_freight_cell.setCellStyle(text_style);

                Cell load_to_sic1_cell = new_row.createCell(4);
                load_to_sic1_cell.setCellValue(load_to_sic1);
                load_to_sic1_cell.setCellStyle(text_style);

                Cell must_clear_sic_cell = new_row.createCell(5);
                must_clear_sic_cell.setCellValue(must_clear_sic);
                must_clear_sic_cell.setCellStyle(text_style);

                Cell must_clear_shift_cell = new_row.createCell(6);
                must_clear_shift_cell.setCellValue(must_clear_shift);
                must_clear_shift_cell.setCellStyle(text_style);

                Cell load_to_sic2_cell = new_row.createCell(7);
                load_to_sic2_cell.setCellValue(load_to_sic2);
                load_to_sic2_cell.setCellStyle(text_style);

                Cell load_to_sic3_cell = new_row.createCell(8);
                load_to_sic3_cell.setCellValue(load_to_sic3);
                load_to_sic3_cell.setCellStyle(text_style);

                Cell dest_sic_cell = new_row.createCell(9);
                dest_sic_cell.setCellValue(dest_sic);
                dest_sic_cell.setCellStyle(recommended_door?callout_style:dest_style);

            }
            rowCounter--;
            sheet.autoSizeColumn(3);
            sheet.autoSizeColumn(4);
            sheet.autoSizeColumn(5);
            sheet.autoSizeColumn(7);
            sheet.autoSizeColumn(8);

            sheet.createFreezePane(0, 1, 0, 1);
            //sheet.setAutoFilter(new CellRangeAddress.valueOf("C5:F200"));
            sheet.setAutoFilter(new CellRangeAddress(0, rowCounter,0, 11));

            // sheet.setColumnView(3, 12);
           // sheet.setColumnView(4, 12);
           // sheet.setColumnView(11, 10);
           // sheet.setColumnView(14, 10);
           // sheet.setColumnView(15, 10);
           // sheet.setColumnView(16, 11);
           // sheet.setColumnView(17, 11);


            System.out.println("point 4");

            String sql_query2 = "select sic from sic_doors;";
            System.out.println(sql_query2);
            ResultSet rs2 = stmt.executeQuery(sql_query2);
            System.out.println("point 2.1");
            rs2.setFetchSize(10000);

            String door_sic;
            int door_sic_counter = 0;

            while (rs2.next()) {
                 door_sic_counter++;
                 door_sic = rs2.getString("sic");
                 String sql_updated_cwfeng = "insert into sic_doors values('" + instruction_date +"', '" + door_sic + "','" + sic + "');"; // to be updated

                 stmt_cwfeng.executeUpdate(sql_updated_cwfeng);
             }
            System.out.println("Finished inserting for " + sic + "\n");

            rs = stmt_cwfeng.executeQuery(add_door_sql_query);
            rs.setFetchSize(1000);
            System.out.println("point 5");
            rowCounter = 0;


            String added_door;
            String removed_door;

            Row header_row = sheet1.createRow(rowCounter);


            Cell added_door_header = header_row.createCell(0);

            added_door_header.setCellValue("Added Doors");
            added_door_header.setCellStyle(header_highlighted_style);

            while (rs.next())
            {
                rowCounter++;
                Row new_row = sheet1.createRow(rowCounter);
                Cell added_door_cell = new_row.createCell(0);
                added_door = rs.getString("door_sic");
                added_door_cell.setCellValue(added_door);
                added_door_cell.setCellStyle(text_style);

            }


            rowCounter += 2;
            Row removed_header_row = sheet1.createRow(rowCounter);
            Cell removed_door_header = removed_header_row.createCell(0);

            removed_door_header.setCellValue("Removed Doors");
            removed_door_header.setCellStyle(header_highlighted_style);


            rs = stmt_cwfeng.executeQuery(remove_door_sql_query);
            rs.setFetchSize(1000);
            System.out.println("point 6");
            while (rs.next())
            {
                rowCounter++;
                Row new_row = sheet1.createRow(rowCounter);
                Cell removed_door_cell = new_row.createCell(0);
                removed_door = rs.getString("door_sic");
                removed_door_cell.setCellValue(removed_door);
                removed_door_cell.setCellStyle(text_style);


            }

            sheet1.autoSizeColumn(0);

            //FileOutputStream fileOut = new FileOutputStream("C:\\Users\\zhang.mingming\\Documents\\Projects\\FFO doorplanning tool POI\\out\\dayfreight\\" + sic + "_door_planning_" + instruction_date + ".xls");
            //workbook.write(fileOut);
            //fileOut.close();
            FileOutputStream fileOut_official = new FileOutputStream("O:\\Freight\\FreightFlowPlans\\PLANNING WORKBOOKS\\Door Planning Tool\\" + sic + "_door_planning" + ".xls");
            workbook.write(fileOut_official);
            fileOut_official.close();
            if(sending_email_ind)
            {
               String to_address1 =  "opspersonnel-" + sic + "@con-way.com";
               sendJavaMail(sic, "O:\\Freight\\FreightFlowPlans\\PLANNING WORKBOOKS\\Door Planning Tool\\" + sic + "_door_planning" + ".xls", to_address1);
               String to_address2 =  "east.jacob@con-way.com";
               sendJavaMail(sic, "O:\\Freight\\FreightFlowPlans\\PLANNING WORKBOOKS\\Door Planning Tool\\" + sic + "_door_planning" + ".xls", to_address2);
               String to_address3 =  "leathers.michael@con-way.com";
               sendJavaMail(sic, "O:\\Freight\\FreightFlowPlans\\PLANNING WORKBOOKS\\Door Planning Tool\\" + sic + "_door_planning" + ".xls", to_address3);
            //String sql_query2 = "difference between last week and the week before last"
            }
        }
        catch(Exception e)
        {
            System.out.println
                    ("Error, SQL failed.\n");

        }
        finally {
            try { prdwhsevwConn.close(); } catch (Exception e) { /* ignored */ }
            try { prdcwfengConn.close(); } catch (Exception e) { /* ignored */ }
        //    try { conn.close(); } catch (Exception e) { /* ignored */ }
        }

    }
    public static Connection getConnection_PRD_CWFENG() throws SQLException
    {
        try
        {
            Class.forName("org.netezza.Driver").newInstance();
            Connection c = DriverManager.getConnection("jdbc:netezza://npsdwh.con-way.com/PRD_CWFENG", "zhang.mingming", "jingchen");
            //c.setAutoCommit(false);
            return c;
        }
        catch (Exception e)
        {
            System.out.println
                    ("Error, CWFENG Connection not made.\n");
        }
        return null;

    }
    public static Connection getConnection_PRD_WHSEVIEW() throws SQLException
    {
        try
        {
            Class.forName("org.netezza.Driver").newInstance();
            Connection c = DriverManager.getConnection("jdbc:netezza://npsdwh.con-way.com/PRD_WHSEVIEW?allowMultiQuery=true", "zhang.mingming", "jingchen");
            c.setAutoCommit(false);
            return c;
        }
        catch (Exception e)
        {
            System.out.println
                    ("Error, WHSEVIEW Connection not made.\n");
        }
        return null;
    }
    public void sendJavaMail(String sic, String filename, String to_address)
    {
        // Recipient's email ID needs to be mentioned.
        //String to = "opspersonnel-" + sic + "@con-way.com";
        //String to = "zhang.mingming@con-way.com";
        // Sender's email ID needs to be mentioned
        String from = "zhang.mingming@con-way.com";

        // Assuming you are sending email from localhost
        String host = "CGOPRCL001.conway.prod.con-way.com";

        // Get system properties
        Properties properties = System.getProperties();

        // Setup mail server
        properties.setProperty("mail.smtp.host", host);

        // Get the default Session object.
        Session session = Session.getDefaultInstance(properties);

        try{
            // Create a default MimeMessage object.
            MimeMessage message = new MimeMessage(session);

            // Set From: header field of the header.
            message.setFrom(new InternetAddress(from));

            // Set To: header field of the header.
            message.addRecipient(Message.RecipientType.TO,
                    new InternetAddress(to_address));

            // Set Subject: header field
            message.setSubject("Door Planning Tool");

            // Create the message part
            BodyPart messageBodyPart = new MimeBodyPart();

            // Fill the message
            messageBodyPart.setText("The door planning tool is also available at O:\\Freight\\FreightFlowPlans\\PLANNING WORKBOOKS\\Door Planning Tool\n");

            // Create a multipar message
            Multipart multipart = new MimeMultipart();

            // Set text message part
            multipart.addBodyPart(messageBodyPart);

            // Part two is attachment
            messageBodyPart = new MimeBodyPart();
            DataSource source = new FileDataSource(filename);
            messageBodyPart.setDataHandler(new DataHandler(source));
            messageBodyPart.setFileName("Door Planning Tool.xls");
            multipart.addBodyPart(messageBodyPart);

            // Send the complete message parts
            message.setContent(multipart );

            // Send message
            Transport.send(message);
            System.out.println("Sent message successfully....");
        }catch (MessagingException mex) {
            mex.printStackTrace();
        }
    }


}
